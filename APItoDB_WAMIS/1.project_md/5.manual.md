 manual.md


    1 # 사용자/관리자 매뉴얼 (Manual)
    2
    3 ## 1. 데이터 수집기 소개
    4
    5 데이터 수집기는 국가수자원관리종합정보시스템(WAMIS) 및 한국농어촌공사(KRC) 농업용수관리자동화시스템(RIMS)에서 제공하는
      수자원 및 농업용 저수지 관련 데이터를 자동으로 수집하여 PostgreSQL 데이터베이스에 저장해주는
      윈도우 애플리케이션입니다. 이 프로그램을 통해 WAMIS의 강수량, 수위, 기상, 유량 데이터와
      KRC의 농업용 저수지 코드, 일별 수위 및 저수율 데이터를 손쉽게 관리하고 분석을 위한 기반을 마련할 수 있습니다.
    6
    7 ## 2. 시스템 요구사항
    8
    9 - **운영체제:** Windows 10 이상
   10 - **필수 소프트웨어:** .NET Framework 4.8 (대부분의 Windows에 기본 설치되어
      있음)
   11 - **데이터베이스:** PostgreSQL 서버 (네트워크를 통해 접근 가능해야 함)
   12
   13 ## 3. 설치 및 설정
   14
   15 ### 3.1. 프로그램 설치
   16
   17 WamisDataCollector는 별도의 설치 과정 없이 압축 해제 후 바로 사용할 수 있는
      포터블(Portable) 프로그램입니다.
   18
   19 1.  제공된 `WamisDataCollector.zip` 파일의 압축을 원하는 위치에 해제합니다.
   20 2.  압축 해제된 폴더로 이동합니다.
   21
   22 ### 3.2. 환경 설정
   23
   24 프로그램을 실행하기 전에, `config` 폴더 안에 있는 `App.config` 파일을
      수정하여 사용자의 환경에 맞게 설정을 변경해야 합니다.
   25
   26 1.  압축 해제한 폴더 내의 `config` 폴더로 이동합니다.
   27 2.  메모장이나 다른 텍스트 편집기로 `App.config` 파일을 엽니다.
   28 3.  `appSettings` 및 `connectionStrings` 섹션의 값을 아래 가이드에 따라
      수정합니다.

  <configuration>
    <appSettings>
      <!-- WAMIS에서 발급받은 일반 인증키를 입력합니다. -->
      <add key="WamisApiKey" value="YOUR_WAMIS_API_KEY" />
      <!-- KRC(농어촌공사)에서 발급받은 API 인증키를 입력합니다. -->
      <add key="KrcApiKey" value="YOUR_KRC_API_KEY" />
      <!-- WAMIS API 서버의 기본 URL입니다. 변경할 필요가 거의 없습니다. -->
      <add key="WamisBaseUrl" value="http://www.wamis.go.kr:8080/wamis/openapi" />
      <!-- KRC API 기본 URL은 서비스 코드 내에 하드코딩되어 있습니다. (필요시 설정으로 이동 가능) -->
    </appSettings>
    <connectionStrings>
      <!-- 데이터를 저장할 PostgreSQL 데이터베이스의 연결 정보를 입력합니다. -->
      <add name="PostgreSqlConnection"
        connectionString="Server=YOUR_DB_SERVER_IP;Port=5432;Database=YOUR_DB_NAME;User Id=YOUR_DB_USER;Password=YOUR_DB_PASSWORD;" />
    </connectionStrings>
  </configuration>
    1
    2 -   **`WamisApiKey`**: WAMIS 포털에서 발급받은 본인의 API 인증키를 `YOUR_WAMIS_API_KEY` 부분에 입력합니다.
    3 -   **`KrcApiKey`**: 한국농어촌공사(또는 공공데이터포털)에서 발급받은 KRC 농업용 저수지 정보 API 인증키를 `YOUR_KRC_API_KEY` 부분에 입력합니다.
    4 -   **`connectionString`**:
    5     -   `YOUR_DB_SERVER_IP`: PostgreSQL 데이터베이스 서버의 IP 주소 또는 도메인 이름을 입력합니다.
    6     -   `YOUR_DB_NAME`: 데이터를 저장할 데이터베이스 이름을 입력합니다.
    7     -   `YOUR_DB_USER`: 데이터베이스 사용자 ID를 입력합니다.
    8     -   `YOUR_DB_PASSWORD`: 데이터베이스 사용자 비밀번호를 입력합니다.
    9
   10 4.  파일을 저장하고 닫습니다.
   11
   12 ## 4. 프로그램 사용법
   13
   14 ### 4.1. 프로그램 실행
   15
   16 -   압축 해제한 폴더에서 `APItoDB_WAMIS.exe` 파일을 더블클릭하여 실행합니다.
   17 -   **참고:** 프로그램 첫 실행 시, `App.config`에 설정된 데이터베이스에 필요한 테이블(`krc_reservoircode`, `reservoirlevel` 등)이 없는 경우 자동으로 생성합니다.
   18
   19 ### 4.2. 화면 구성
   20
   21  <!-- UI 스크린샷 예시 URL -->
   22
   23 -   **기간 설정 (DateTimePicker):** `시작일`과 `종료일`을 선택합니다. 이 기간은 "초기 데이터 로드" 및 "누락 데이터 보충" 기능에 사용됩니다.
   24 -   **테스트 모드 (Checkbox):**
   25     - **WAMIS:** 이 옵션을 체크하면 전체 관측소가 아닌, 각 종류별 대표 관측소 1개에 대해서만 데이터를 수집합니다.
   26     - **KRC:** 이 옵션을 체크하면, DB에 저장된 전체 저수지 목록 중 **첫 번째 저수지 1개에 대해서만 실제 API를 호출하여** 데이터 수집을 진행합니다. 개발 및 기능 테스트 시 유용합니다.
   27 -   **WAMIS 수자원 (GroupBox):**
   28     -   `초기 데이터 로드`: 설정된 기간 동안의 모든 WAMIS 데이터를 API로부터 가져와 데이터베이스에 저장합니다.
   29     -   `일별 최신화`: 어제 하루 동안의 WAMIS 데이터를 가져와 데이터베이스에 추가/업데이트합니다.
   30     -   `누락 데이터 보충`: 최근 7일간의 WAMIS 데이터를 다시 수집하여 데이터베이스를 최신 상태로 업데이트합니다.
   31 -   **KRC 농업용 저수지 (GroupBox):**
   32     -   `전체 코드 조회/저장`: KRC의 모든 농업용 저수지 코드 및 기본 정보(저수지명, 시군명)를 조회하여 **`krc_reservoircode`** 테이블에 저장/업데이트합니다. KRC 수위 데이터를 수집하기 전에 반드시 한 번 이상 실행해야 합니다.
   33     -   `초기 수위 로드`: 설정된 기간 동안 DB에 저장된 모든 KRC 저수지에 대해 수위 데이터를 API로부터 가져와 **`reservoirlevel`** 테이블에 저장합니다. (API 제약에 따라 365일 단위로 분할하여 요청)
   34     -   `수위 일별 최신화`: DB에 저장된 각 KRC 저수지의 마지막 데이터 저장일 다음날부터 오늘까지의 수위 데이터를 가져와 **`reservoirlevel`** 테이블에 추가/업데이트합니다.
   35     -   `수위 누락 보충`: 설정된 기간 동안 DB에 저장된 모든 KRC 저수지에 대해 수위 데이터를 API로부터 다시 가져와 **`reservoirlevel`** 테이블에 저장(Upsert)합니다.
   33 -   **로그 창 (TextBox):** 데이터 수집 과정, API 요청 URL, 성공/실패 여부, 오류 메시지 등 모든 작업 내용이 실시간으로 표시됩니다.
   34 -   **진행률 표시줄 (ProgressBar):** 데이터 수집 작업 진행 시 전체 진행률을 시각적으로 보여줍니다.
   35
   36 ### 4.3. 데이터 수집 절차
   37
   38 #### 4.3.1. WAMIS 데이터
   39
   40 ##### A. 초기 데이터 로드 (최초 실행 시)
   41
   42 1.  프로그램을 실행합니다.
   43 2.  데이터를 수집할 `시작일`과 `종료일`을 선택합니다.
   44 3.  "WAMIS 수자원" 그룹박스 내의 `초기 데이터 로드` 버튼을 클릭합니다.
   45 4.  로그 창을 통해 데이터 수집이 정상적으로 완료될 때까지 기다립니다. (데이터 양에 따라 수 시간이 소요될 수 있습니다.)
   46
   47 ##### B. 일일 데이터 동기화
   48
   49 1.  프로그램을 실행합니다.
   50 2.  "WAMIS 수자원" 그룹박스 내의 `일별 최신화` 버튼을 클릭합니다.
   51 3.  로그 창을 통해 어제 날짜의 데이터 동기화가 완료될 때까지 기다립니다.
   52
   53 ##### C. 최근 7일 데이터 최신화 (필요시)
   54
   55 1.  프로그램을 실행합니다.
   56 2.  "WAMIS 수자원" 그룹박스 내의 `누락 데이터 보충` 버튼을 클릭합니다.
   57 3.  로그 창을 통해 최근 7일간의 데이터가 성공적으로 수집 및 업데이트 될 때까지 기다립니다.
   58
   59 #### 4.3.2. KRC 농업용 저수지 데이터
   60
   61 ##### A. 저수지 코드 전체 조회 (최초 1회 및 필요시)
   62
   63 1.  프로그램을 실행합니다.
   64 2.  "KRC 농업용 저수지" 그룹박스 내의 `전체 코드 조회/저장` 버튼을 클릭합니다.
   65 3.  로그 창을 통해 모든 저수지 코드 정보가 DB(`stations` 테이블)에 저장될 때까지 기다립니다.
   66
   67 ##### B. 초기 수위 데이터 로드 (저수지 코드 조회 후)
   68
   69 1.  프로그램을 실행합니다.
   70 2.  수위 데이터를 수집할 `시작일`과 `종료일`을 선택합니다.
   71 3.  "KRC 농업용 저수지" 그룹박스 내의 `초기 수위 로드` 버튼을 클릭합니다.
   72 4.  로그 창을 통해 모든 KRC 저수지에 대한 지정된 기간의 수위 데이터가 `krc_reservoir_daily` 테이블에 저장될 때까지 기다립니다. (시간이 오래 걸릴 수 있습니다.)
   73
   74 ##### C. 수위 데이터 일별 최신화
   75
   76 1.  프로그램을 실행합니다.
   77 2.  "KRC 농업용 저수지" 그룹박스 내의 `수위 일별 최신화` 버튼을 클릭합니다.
   78 3.  로그 창을 통해 모든 KRC 저수지의 수위 데이터가 최신 상태로 업데이트될 때까지 기다립니다.
   79
   80 ##### D. 수위 데이터 누락 보충 (필요시)
   81
   82 1.  프로그램을 실행합니다.
   83 2.  누락된 데이터를 보충할 `시작일`과 `종료일`을 선택합니다.
   84 3.  "KRC 농업용 저수지" 그룹박스 내의 `수위 누락 보충` 버튼을 클릭합니다.
   85 4.  로그 창을 통해 선택된 기간의 누락된 수위 데이터가 보충될 때까지 기다립니다.
   86
   87 ## 5. 문제 해결 (Troubleshooting)
   88
   89 -   **프로그램이 실행되지 않는 경우:**
   90     -   .NET Framework 4.8이 설치되어 있는지 확인하세요.
   91 -   **데이터 수집이 실패하는 경우:**
   92     -   로그 창에 표시되는 오류 메시지를 확인하세요.
   93     -   `App.config` 파일의 API 키 (`WamisApiKey`, `KrcApiKey`)와 데이터베이스 연결 정보가 올바른지 다시 한 번 확인하세요.
   94     -   인터넷 연결이 정상적인지 확인하세요.
   95     -   PostgreSQL 데이터베이스 서버가 실행 중이고 네트워크 방화벽에서 접근이 허용되어 있는지 확인하세요.
   96 -   **기타 문제:**
   97     -   로그 창의 내용을 복사하여 시스템 관리자에게 문의하세요.